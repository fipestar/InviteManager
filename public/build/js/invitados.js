!function(){!async function(){try{const t=`/api/invitados?id=${r()}`,n=await fetch(t),o=await n.json();e=o.invitados,i()}catch(e){console.log(e)}}();let e=[],t=[];document.querySelector("#agregar-invitados").addEventListener("click",(function(){c(!1)}));document.querySelectorAll('#filtros input[type="radio"]').forEach((e=>{e.addEventListener("input",a)}));let n={asistencia:"",parentesco:""};document.querySelector("#parentesco").addEventListener("input",o);function o(e){"filtro"===e.target.name?n.asistencia=e.target.value:n.parentesco=e.target.value,a()}function a(){let o=e;n.parentesco&&(o=o.filter((e=>e.parentesco===n.parentesco))),n.asistencia&&(o=o.filter((e=>e.asistencia===n.asistencia))),t=o,i()}function i(){!function(){const e=document.querySelector("#listado-invitados");for(;e.firstChild;)e.removeChild(e.firstChild)}();const o=""!==n.asistencia||""!==n.parentesco?t:e;if(0===o.length){const e=document.querySelector("#listado-invitados"),t=document.createElement("LI");return t.textContent="No hay invitados que cumplan con el filtro",t.classList.add("no-invitados"),void e.appendChild(t)}const a={0:"Pendiente",1:"Confirmado"};o.forEach((t=>{const n=document.createElement("LI");n.dataset.invitadoId=t.id,n.classList.add("invitado");const o=document.createElement("P");o.textContent=t.nombre,o.ondblclick=function(){c(editar=!0,{...t})};const s=document.createElement("DIV");s.classList.add("opciones");const l=document.createElement("BUTTON");l.classList.add("asistencia-invitado"),l.classList.add(`${a[t.asistencia].toLowerCase()}`),l.textContent=a[t.asistencia],l.dataset.asistenciaInvitado=t.asistencia,l.ondblclick=function(){!function(e){const t="1"===e.asistencia?"0":"1";e.asistencia=t,d(e)}({...t})};const m=document.createElement("BUTTON");m.classList.add("eliminar-invitado"),m.dataset.eliminarInvitado=t.id,m.textContent="Eliminar",m.ondblclick=function(){!function(t){Swal.fire({title:"¿Estás seguro?",text:"No podrás deshacer esta acción",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Sí, eliminar"}).then((n=>{n.isConfirmed&&async function(t){const{asistencia:n,id:o,nombre:a,eventoId:c}=t,s=new FormData;s.append("id",o),s.append("nombre",a),s.append("asistencia",n),s.append("eventoId",r());try{const n="http://localhost:3000/api/invitado/eliminar",o=await fetch(n,{method:"POST",body:s}),a=await o.json();a.resultado&&Swal.fire("Eliminado",a.mensaje,"success"),e=e.filter((e=>e.id!==t.id)),i()}catch(e){}}(t)}))}({...t})},s.appendChild(l),s.appendChild(m),n.appendChild(o),n.appendChild(s);document.querySelector("#listado-invitados").appendChild(n)}))}function c(t=!1,n={}){const o=document.createElement("DIV");o.classList.add("modal"),o.innerHTML=`\n        <form class="formulario nuevo-invitado">\n          <legend>${t?"Editar Invitado":"Añade un nuevo invitado"}</legend>\n          <div class="campo">\n            <label>Invitado</label>\n             <input\n                type="text"\n                name="invitado"\n                placeholder="${n.nombre?"Editar Nombre del invitado":"Añadir Nombre del invitado"}"\n                id="invitado"\n                value="${n.nombre?n.nombre:""}"\n            />\n          </div>\n          <div class="campo">\n            <label>Parentesco</label>\n            <select name="parentesco" id="parentesco-form">\n                <option value="" ${""===n.parentesco?"selected":""}>-- Seleccione --</option>\n                <option value="familia" ${"familia"===n.parentesco?"selected":""}>Familia</option>\n                <option value="amigos" ${"amigos"===n.parentesco?"selected":""}>Amigos</option>\n                <option value="colegas" ${"colegas"===n.parentesco?"selected":""}>Colegas</option>\n            </select>\n          </div>\n                    <input \n                        type="submit" \n                        class="submit-nuevo-invitado" \n                        value="${n.nombre?"Guardar Cambios":"Añadir Invitado "}" \n                    />\n                    <button type="button" class="cerrar-modal">Cancelar</button>\n                </div>      \n        </form>  \n        `,setTimeout((()=>{document.querySelector(".formulario").classList.add("animar")}),0),document.querySelector("body").appendChild(o),o.addEventListener("click",(function(a){if(a.preventDefault(),a.target.classList.contains("cerrar-modal")||a.target.classList.contains("modal")){document.querySelector(".formulario").classList.add("cerrar"),setTimeout((()=>{o.remove()}),500)}if(a.target.classList.contains("submit-nuevo-invitado")){const o=document.querySelector("#invitado").value.trim(),a=document.querySelector("#parentesco-form").value;if(""===o||""===a)return void s("Todos los campos son obligatorios","error",document.querySelector(".formulario legend"));t?(n.nombre=o,n.parentesco=a,d(n)):async function(t){const n=new FormData;n.append("nombre",t.nombre),n.append("parentesco",t.parentesco),n.append("eventoId",r());try{const o="http://localhost:3000/api/invitado",a=await fetch(o,{method:"POST",body:n}),c=await a.json();if(s(c.mensaje,c.tipo,document.querySelector(".formulario legend")),"exito"===c.tipo){const n=document.querySelector(".modal");setTimeout((()=>{n.remove()}),3e3);const o={id:String(c.id),nombre:t.nombre,parentesco:t.parentesco,asistencia:"0",eventoId:c.eventoId};e=[...e,o],i()}}catch(e){console.log(e)}}({nombre:o,parentesco:a})}})),document.querySelector("body").appendChild(o)}function s(e,t,n){const o=document.querySelector(".alerta");o&&o.remove();const a=document.createElement("DIV");a.classList.add("alerta",t),a.textContent=e,n.parentElement.insertBefore(a,n.nextElementSibling),setTimeout((()=>{a.remove()}),3e3)}function r(){const e=new URLSearchParams(window.location.search);return Object.fromEntries(e.entries()).id}async function d(t){const{asistencia:n,id:o,nombre:a,eventoId:c,parentesco:s}=t,d=new FormData;d.append("id",o),d.append("nombre",a),d.append("asistencia",n),d.append("eventoId",r()),d.append("parentesco",s);try{const t="http://localhost:3000/api/invitado/actualizar",c=await fetch(t,{method:"POST",body:d}),r=await c.json();if("exito"===r.respuesta.tipo){Swal.fire(r.respuesta.mensaje,r.respuesta.mensaje,"success");const e=document.querySelector(".modal");e&&e.remove()}e=e.map((e=>(e.id===o&&(e.asistencia=n,e.nombre=a,e.parentesco=s),e))),i()}catch(e){console.log(e)}}document.querySelectorAll('#filtros input[type="radio"]').forEach((e=>{e.addEventListener("input",o)}))}();