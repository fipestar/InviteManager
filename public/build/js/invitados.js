!function(){!async function(){try{const t=`/api/invitados?id=${c()}`,n=await fetch(t),a=await n.json();e=a.invitados,o()}catch(e){console.log(e)}}();let e=[],t=[];document.querySelector("#agregar-invitados").addEventListener("click",(function(){a(!1)}));function n(n){const a=n.target.value;t=""!==a?e.filter((e=>e.asistencia===a)):[],o()}function o(){!function(){const e=document.querySelector("#listado-invitados");for(;e.firstChild;)e.removeChild(e.firstChild)}();const n=t.length?t:e;if(0===n.length){const e=document.querySelector("#listado-invitados"),t=document.createElement("LI");return t.textContent="No hay invitados aún",t.classList.add("no-invitados"),void e.appendChild(t)}const i={0:"Pendiente",1:"Confirmado"};n.forEach((t=>{const n=document.createElement("LI");n.dataset.invitadoId=t.id,n.classList.add("invitado");const s=document.createElement("P");s.textContent=t.nombre,s.ondblclick=function(){a(editar=!0,{...t})};const r=document.createElement("DIV");r.classList.add("opciones");const l=document.createElement("BUTTON");l.classList.add("asistencia-invitado"),l.classList.add(`${i[t.asistencia].toLowerCase()}`),l.textContent=i[t.asistencia],l.dataset.asistenciaInvitado=t.asistencia,l.ondblclick=function(){!function(e){const t="1"===e.asistencia?"0":"1";e.asistencia=t,d(e)}({...t})};const m=document.createElement("BUTTON");m.classList.add("eliminar-invitado"),m.dataset.eliminarInvitado=t.id,m.textContent="Eliminar",m.ondblclick=function(){!function(t){Swal.fire({title:"¿Estás seguro?",text:"No podrás deshacer esta acción",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Sí, eliminar"}).then((n=>{n.isConfirmed&&async function(t){const{asistencia:n,id:a,nombre:i,eventoId:d}=t,s=new FormData;s.append("id",a),s.append("nombre",i),s.append("asistencia",n),s.append("eventoId",c());try{const n="http://localhost:3000/api/invitado/eliminar",a=await fetch(n,{method:"POST",body:s}),i=await a.json();i.resultado&&Swal.fire("Eliminado",i.mensaje,"success"),e=e.filter((e=>e.id!==t.id)),o()}catch(e){}}(t)}))}({...t})},r.appendChild(l),r.appendChild(m),n.appendChild(s),n.appendChild(r);document.querySelector("#listado-invitados").appendChild(n)}))}function a(t=!1,n={}){const a=document.createElement("DIV");a.classList.add("modal"),a.innerHTML=`\n        <form class="formulario nuevo-invitado">\n          <legend>${t?"Editar Invitado":"Añade un nuevo invitado"}</legend>\n          <div class="campo">\n            <label>Invitado</label>\n             <input\n                type="text"\n                name="invitado"\n                placeholder="${n.nombre?"Editar Nombre del invitado":"Añadir Nombre del invitado"}"\n                id="invitado"\n                value="${n.nombre?n.nombre:""}"\n            />\n          </div>\n          <div class="opciones">\n                    <input \n                        type="submit" \n                        class="submit-nuevo-invitado" \n                        value="${n.nombre?"Guardar Cambios":"Añadir Invitado "}" \n                    />\n                    <button type="button" class="cerrar-modal">Cancelar</button>\n                </div>      \n        </form>  \n        `,setTimeout((()=>{document.querySelector(".formulario").classList.add("animar")}),0),document.querySelector("body").appendChild(a),a.addEventListener("click",(function(s){if(s.preventDefault(),s.target.classList.contains("cerrar-modal")||s.target.classList.contains("modal")){document.querySelector(".formulario").classList.add("cerrar"),setTimeout((()=>{a.remove()}),500)}if(s.target.classList.contains("submit-nuevo-invitado")){const a=document.querySelector("#invitado").value.trim();if(""===a)return void i("El nombre del invitado es obligatorio","error",document.querySelector(".formulario legend"));t?(n.nombre=a,d(n)):async function(t){const n=new FormData;n.append("nombre",t),n.append("eventoId",c());try{const a="http://localhost:3000/api/invitado",c=await fetch(a,{method:"POST",body:n}),d=await c.json();if(i(d.mensaje,d.tipo,document.querySelector(".formulario legend")),"exito"===d.tipo){const n=document.querySelector(".modal");setTimeout((()=>{n.remove()}),3e3);const a={id:String(d.id),nombre:t,asistencia:"0",eventoId:d.eventoId};e=[...e,a],o()}}catch(e){console.log(e)}}(a)}})),document.querySelector("body").appendChild(a)}function i(e,t,n){const o=document.querySelector(".alerta");o&&o.remove();const a=document.createElement("DIV");a.classList.add("alerta",t),a.textContent=e,n.parentElement.insertBefore(a,n.nextElementSibling),setTimeout((()=>{a.remove()}),3e3)}function c(){const e=new URLSearchParams(window.location.search);return Object.fromEntries(e.entries()).id}async function d(t){const{asistencia:n,id:a,nombre:i,eventoId:d}=t,s=new FormData;s.append("id",a),s.append("nombre",i),s.append("asistencia",n),s.append("eventoId",c());try{const t="http://localhost:3000/api/invitado/actualizar",c=await fetch(t,{method:"POST",body:s}),d=await c.json();if("exito"===d.respuesta.tipo){Swal.fire(d.respuesta.mensaje,d.respuesta.mensaje,"success");const e=document.querySelector(".modal");e&&e.remove()}e=e.map((e=>(e.id===a&&(e.asistencia=n,e.nombre=i),e))),o()}catch(e){console.log(e)}}document.querySelectorAll('#filtros input[type="radio"]').forEach((e=>{e.addEventListener("input",n)}))}();